<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Che Burlesque Â· Casting</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0e0e0e;
      color: #f5f5f5;
    }

    header {
      padding: 15px;
      background: #000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
    }

    header h1 {
      font-size: 18px;
      margin: 0;
      letter-spacing: 1px;
    }

    header button {
      background: #b00020;
      border: none;
      color: white;
      padding: 8px 14px;
      cursor: pointer;
      border-radius: 6px;
      font-size: 14px;
    }

    main {
      padding: 20px;
      max-width: 1100px;
      margin: auto;
    }

    .upload {
      margin-bottom: 20px;
    }

    input[type="file"] {
      margin-top: 10px;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
    }

    .card {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 6px solid #7f8c8d;
    }

    .card.yes { border-left-color: #27ae60; }
    .card.obs { border-left-color: #f1c40f; }
    .card.no  { border-left-color: #c0392b; }

    .card h3 {
      margin-top: 0;
    }

    .links a {
      color: #e6b8ff;
      display: block;
      word-break: break-all;
      font-size: 0.9em;
    }

    select, textarea {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      border-radius: 4px;
      border: none;
      background: #000;
      color: #fff;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .export {
      margin-top: 30px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .export button {
      background: #333;
      color: white;
      border: 1px solid #555;
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 6px;
    }
  </style>
</head>

<body>

<header>
  <h1>Che Burlesque Â· Casting</h1>
  <button onclick="nuevoCasting()">ðŸ†• Nuevo casting</button>
</header>

<main>

  <div class="upload">
    <strong>Cargar postulantes (CSV o XLSX)</strong><br>
    <input type="file" id="fileInput">
  </div>

  <div class="cards" id="cards"></div>

  <div class="export">
    <button onclick="exportar('sigue')">Exportar Â· Siguen</button>
    <button onclick="exportar('no')">Exportar Â· No siguen</button>
  </div>

</main>

<script>
  const STORAGE_KEY = 'cheBurlesqueCasting';
  let postulantes = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

  const cards = document.getElementById('cards');
  render();

  document.getElementById('fileInput').addEventListener('change', handleFile);

  function handleFile(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = evt => {
      const text = evt.target.result;
      const rows = text.split('\n').slice(1);

      rows.forEach(r => {
        const cols = r.split(',');
        if (!cols[0]) return;

        postulantes.push({
          nombre: cols[0],
          video: cols.find(c => c.includes('http')) || '',
          estado: '',
          observaciones: ''
        });
      });

      save();
      render();
    };
    reader.readAsText(file);
  }

  function render() {
    cards.innerHTML = '';
    postulantes.forEach((p, i) => {
      const card = document.createElement('div');
      card.className = 'card';

      card.innerHTML = `
        <h3>${p.nombre}</h3>

        ${p.video ? `<div class="video"><a href="${p.video}" target="_blank">Ver video</a></div>` : ''}

        <div class="status">
          Estado:
          <select onchange="setEstado(${i}, this.value)">
            <option value="">Pendiente</option>
            <option value="sigue" ${p.estado === 'sigue' ? 'selected' : ''}>Sigue</option>
            <option value="observacion" ${p.estado === 'observacion' ? 'selected' : ''}>Sigue con observaciones</option>
            <option value="no" ${p.estado === 'no' ? 'selected' : ''}>No sigue</option>
          </select>
        </div>

        <textarea placeholder="Observaciones..." oninput="setObs(${i}, this.value)">${p.observaciones || ''}</textarea>
      `;

      cards.appendChild(card);
    });
  }

  function setEstado(i, val) {
    postulantes[i].estado = val;
    save();
  }

  function setObs(i, val) {
    postulantes[i].observaciones = val;
    save();
  }

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(postulantes));
  }

  function exportar(tipo) {
    const data = postulantes.filter(p => p.estado === tipo);
    let csv = 'Nombre,Video,Estado,Observaciones\n';

    data.forEach(p => {
      csv += `"${p.nombre}","${p.video}","${p.estado}","${p.observaciones}"\n`;
    });

    download(csv, `casting-${tipo}.csv`);
  }

  function download(text, filename) {
    const blob = new Blob([text], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
  }

  function nuevoCasting() {
    const ok = confirm(
      'Â¿Seguro que deseas iniciar un NUEVO CASTING?\n\nEsto eliminarÃ¡ todos los postulantes actuales.'
    );
    if (!ok) return;

    postulantes = [];
    save();
    render();
  }
</script>

</body>
</html>  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
}
.card.pending { border-left:6px solid #7f8c8d; }
.card.yes { border-left:6px solid #27ae60; }
.card.obs { border-left:6px solid #f1c40f; }
.card.no  { border-left:6px solid #c0392b; }

.links a {
  color:#1abc9c;
  display:block;
  word-break:break-all;
  font-size:.9em;
}

textarea {
  width:100%;
  margin-top:8px;
  padding:8px;
  border-radius:4px;
  border:none;
  resize:vertical;
}
hr { opacity:.2; }
</style>
</head>

<body>

<h1>ðŸŽ­ Evaluador de Casting</h1>
<small>Che Burlesque Producciones</small><br>

<input type="file" id="fileInput" accept=".csv,.xlsx"><br>

<button class="btn-export" onclick="exportar('yes')">Exportar Seleccionadas</button>
<button class="btn-export" onclick="exportar('obs')">Exportar Seleccionadas con Observaciones</button>
<button class="btn-export" onclick="exportar('no')">Exportar No Seleccionadas</button>

<hr>
<div id="cards"></div>

<script>
const STORAGE_KEY = "che_burlesque_casting_pwa";
let postulantes = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

function guardar() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(postulantes));
}

function detectarLinks(texto) {
  return texto ? texto.match(/https?:\/\/[^\s]+/g) || [] : [];
}

function render() {
  const c = document.getElementById("cards");
  c.innerHTML = "";

  postulantes.forEach((p,i)=>{
    const links=[];
    Object.values(p.data).forEach(v=>{
      detectarLinks(String(v)).forEach(l=>links.push(l));
    });

    const d=document.createElement("div");
    d.className=`card ${p.status}`;
    d.innerHTML=`
      <strong>Postulante ${i+1}</strong><br><br>

      ${Object.entries(p.data).map(([k,v])=>`
        <small>${k}</small><br>${v}<br><br>
      `).join("")}

      ${links.length?`
      <div class="links"><strong>ðŸŽ¥ Videos</strong>
        ${links.map(l=>`<a href="${l}" target="_blank">${l}</a>`).join("")}
      </div><br>`:""}

      <button class="btn-yes" onclick="setStatus(${i},'yes')">Seleccionada</button>
      <button class="btn-obs" onclick="setStatus(${i},'obs')">Seleccionada con observaciones</button>
      <button class="btn-no" onclick="setStatus(${i},'no')">No seleccionada</button>

      ${p.status==="obs"?`
        <textarea placeholder="Observaciones curatoriales"
          oninput="setObs(${i},this.value)">${p.observations||""}</textarea>
      `:""}

      <small>${p.evaluatedAt? "Evaluado: "+new Date(p.evaluatedAt).toLocaleString():""}</small>
    `;
    c.appendChild(d);
  });
}

function setStatus(i,s){
  postulantes[i].status=s;
  postulantes[i].evaluatedAt=new Date().toISOString();
  guardar(); render();
}
function setObs(i,v){ postulantes[i].observations=v; guardar(); }

document.getElementById("fileInput").addEventListener("change",e=>{
  const f=e.target.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=ev=>{
    const wb=XLSX.read(new Uint8Array(ev.target.result),{type:"array"});
    const sh=wb.Sheets[wb.SheetNames[0]];
    postulantes=XLSX.utils.sheet_to_json(sh).map(row=>({
      data:row,status:"pending",observations:""
    }));
    guardar(); render();
  };
  r.readAsArrayBuffer(f);
});

function exportar(status){
  const data=postulantes.filter(p=>p.status===status).map(p=>({
    ...p.data,
    estado:status,
    observaciones:p.observations||"",
    fecha:p.evaluatedAt||""
  }));
  if(!data.length)return alert("No hay datos");
  const ws=XLSX.utils.json_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,status);
  XLSX.writeFile(wb,`casting_${status}.xlsx`);
}

render();

// REGISTRO SERVICE WORKER
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>  border-radius:8px;
  margin-bottom:15px;
}
.card.pending { border-left:6px solid #7f8c8d; }
.card.yes { border-left:6px solid #27ae60; }
.card.obs { border-left:6px solid #f1c40f; }
.card.no  { border-left:6px solid #c0392b; }

.links a {
  color:#1abc9c;
  display:block;
  word-break:break-all;
  font-size:.9em;
}

textarea {
  width:100%;
  margin-top:8px;
  padding:8px;
  border-radius:4px;
  border:none;
  resize:vertical;
}
hr { opacity:.2; }
</style>
</head>

<body>

<h1>ðŸŽ­ Evaluador de Casting</h1>
<small>Che Burlesque Producciones</small><br>

<input type="file" id="fileInput" accept=".csv,.xlsx"><br>

<button class="btn-export" onclick="exportar('yes')">Exportar Seleccionadas</button>
<button class="btn-export" onclick="exportar('obs')">Exportar Seleccionadas con Observaciones</button>
<button class="btn-export" onclick="exportar('no')">Exportar No Seleccionadas</button>

<hr>
<div id="cards"></div>

<script>
/* ===============================
   DATOS Y STORAGE
================================*/
const STORAGE_KEY = "che_burlesque_casting_pwa";
let postulantes = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

function guardar() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(postulantes));
}

/* ===============================
   LINKS
================================*/
function detectarLinks(texto) {
  return texto ? texto.match(/https?:\/\/[^\s]+/g) || [] : [];
}

/* ===============================
   RENDER
================================*/
function render() {
  const c = document.getElementById("cards");
  c.innerHTML = "";

  postulantes.forEach((p,i)=>{
    const links=[];
    Object.values(p.data).forEach(v=>{
      detectarLinks(String(v)).forEach(l=>links.push(l));
    });

    const d=document.createElement("div");
    d.className=`card ${p.status}`;
    d.innerHTML=`
      <strong>Postulante ${i+1}</strong><br><br>
      ${Object.entries(p.data).map(([k,v])=>`
        <small>${k}</small><br>${v}<br><br>
      `).join("")}

      ${links.length?`
      <div class="links"><strong>ðŸŽ¥ Videos</strong>
        ${links.map(l=>`<a href="${l}" target="_blank">${l}</a>`).join("")}
      </div><br>`:""}

      <button class="btn-yes" onclick="setStatus(${i},'yes')">Seleccionada</button>
      <button class="btn-obs" onclick="setStatus(${i},'obs')">Seleccionada con observaciones</button>
      <button class="btn-no" onclick="setStatus(${i},'no')">No seleccionada</button>

      ${p.status==="obs"?`
        <textarea placeholder="Observaciones curatoriales"
          oninput="setObs(${i},this.value)">${p.observations||""}</textarea>
      `:""}

      <small>${p.evaluatedAt? "Evaluado: "+new Date(p.evaluatedAt).toLocaleString():""}</small>
    `;
    c.appendChild(d);
  });
}

function setStatus(i,s){
  postulantes[i].status=s;
  postulantes[i].evaluatedAt=new Date().toISOString();
  guardar(); render();
}
function setObs(i,v){ postulantes[i].observations=v; guardar(); }

/* ===============================
   IMPORTAR
================================*/
document.getElementById("fileInput").addEventListener("change",e=>{
  const f=e.target.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=ev=>{
    const wb=XLSX.read(new Uint8Array(ev.target.result),{type:"array"});
    const sh=wb.Sheets[wb.SheetNames[0]];
    postulantes=XLSX.utils.sheet_to_json(sh).map(row=>({
      data:row,status:"pending",observations:""
    }));
    guardar(); render();
  };
  r.readAsArrayBuffer(f);
});

/* ===============================
   EXPORTAR
================================*/
function exportar(status){
  const data=postulantes.filter(p=>p.status===status).map(p=>({
    ...p.data,
    estado:status,
    observaciones:p.observations||"",
    fecha:p.evaluatedAt||""
  }));
  if(!data.length)return alert("No hay datos");
  const ws=XLSX.utils.json_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,status);
  XLSX.writeFile(wb,`casting_${status}.xlsx`);
}

render();

/* ===============================
   PWA EN UN SOLO ARCHIVO
================================*/

// MANIFEST
const manifest = {
  name: "Evaluador de Casting â€“ Che Burlesque",
  short_name: "Casting Che",
  start_url: ".",
  display: "standalone",
  background_color: "#0f0f0f",
  theme_color: "#0f0f0f"
};
const manifestBlob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
const manifestURL = URL.createObjectURL(manifestBlob);
const link = document.createElement('link');
link.rel = 'manifest';
link.href = manifestURL;
document.head.appendChild(link);

// SERVICE WORKER
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE = 'che-burlesque-pwa-v1';
    self.addEventListener('install', e=>{
      e.waitUntil(
        caches.open(CACHE).then(c=>c.addAll(['./']))
      );
      self.skipWaiting();
    });
    self.addEventListener('fetch', e=>{
      e.respondWith(
        caches.match(e.request).then(r=>r||fetch(e.request))
      );
    });
  `;
  const swBlob = new Blob([swCode], {type:'text/javascript'});
  const swURL = URL.createObjectURL(swBlob);
  navigator.serviceWorker.register(swURL);
}
</script>

</body>
</html>
